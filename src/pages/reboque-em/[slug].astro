---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Navigation from '../../components/Navigation.astro';
import Hero from '../../components/Hero.astro';
import AboutUs from '../../components/AboutUs.astro';
import RichFAQ from '../../components/RichFAQ.astro';
import WhatsappSection from '../../components/WhatsappSection.astro';
import ContactSection from '../../components/ContactSection.astro';
import Footer from '../../components/Footer.astro';
import heroBg from '../../assets/hero-bg.png';

const siteUrl = "https://www.juniauto.com.br";
export async function getStaticPaths() {
  const neighborhoodEntries = await getCollection('neighborhoods');
  return neighborhoodEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const jsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "AutomotiveBusiness",
      "name": `Juniauto Reboque em ${entry.data.name}`,
      "description": entry.data.description,
      "url": `https://www.juniauto.com.br/reboque-em/${entry.slug}`,
      "telephone": "+5521982769969",
      "image": siteUrl + heroBg.src,
      "areaServed": {
        "@type": "AdministrativeArea",
        "name": entry.data.name
      },
      "provider": {
        "@type": "LocalBusiness",
        "name": "Juniauto - Reboque 24h",
        "@id": "https://www.juniauto.com.br/#organization",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Estr. Guandú do Sapé, 1455",
          "addressLocality": "Campo Grande",
          "addressRegion": "RJ",
          "postalCode": "23095-071",
          "addressCountry": "BR"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": -22.884523,
          "longitude": -43.551061
        },
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.juniauto.com.br/header_logo.png",
          "width": "373",
          "height": "144"
        }
      }
    }
  ]
};

const ctaMessage = `Olá, preciso de um reboque em ${entry.data.name}.`;
const ctaLink = `https://wa.me/5521982769969?text=${encodeURIComponent(ctaMessage)}`;
---

<Layout title={`${entry.data.h1} | Juniauto 24h`} description={entry.data.description} zapLink={ctaLink}>
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  
  <Navigation zapLink={ctaLink} />
  
  <main class="pt-20">
    <Hero 
      title1={`Reboque em ${entry.data.name}`}
      title2={entry.data.h1}
      description={entry.data.description}
      ctaLink={ctaLink}
    />
    
    <AboutUs title={`Atendimento em ${entry.data.name}`} subtitle={`O salvador local de ${entry.data.name}`}>
       <Content />
    </AboutUs>

    <RichFAQ customFaqs={entry.data.faq} />
    
    <WhatsappSection zapLink={ctaLink} />
    
    <ContactSection />
  </main>

  <Footer />
</Layout>
